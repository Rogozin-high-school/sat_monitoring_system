<html>
    <head>
        <script type='text/javascript'>
            
            //function to set torquer values
            function updateTorquer(dict)
            {
                var str="";
                var keys = Object.keys(dict);
                keys.forEach(function(element){
                    str+=element+"="+dict[element];
                });
                console.log(str);
                //making the http request to set 
                httpRequest("set_magnetorquer?"+str).then((raw)=>{;});
            }
            function httpRequest(url) {
                return new Promise((success, error) => {
                    var xmlhttp = new XMLHttpRequest();
                    xmlhttp.onreadystatechange = function() {
                        if (this.readyState == 4) {
                            if (this.status == 200) {
                                success(xmlhttp.responseText);
                            }
                            else {
                                error(xmlhttp.status);
                            }
                        }
                    };
                    xmlhttp.open("GET", url, true);
                    xmlhttp.send(null);
                });
            }
            function parse(raw) {
                var temp = [];
                var arr = raw.split(",");
                for(var i = 0; i < arr.length; i++) {
                    var arr1 = arr[i].split(":");
                    temp[temp.length] = arr1;
                }
                return temp;
            }
            function loop() {
                var val = "";
                httpRequest("get_magnetometer").then((raw) => {;
                    raw = raw.replace("{", "");
                    raw = raw.replace("}", "");
                    var arr = parse(raw);
                    for(i=0;i<arr.length;i++)
                    {
                        val= arr[i][1];
                        document.getElementById("element"+i.toString()).innerText = val;
                    }
                    /*arr.forEach((element) => {
                        val += element[1];
                        document.getElementById("element"+)
                    });
                    document.getElementById("element").innerHTML = val;*/
                });
            }
            function set()
            {
                var dict = [];
                var str = "xyz";
                str.forEach(function(element){
                    dict[element] = document.getElementById("set"+element.toUpperCase()).value; 
                });
                updateTorquer(dict);
            }
            setInterval(loop,1000);
            
        </script>

    </head>

    <body>
        <table border='2'><tr><td>X</td><td>Y</td><td>Z</td>></tr>
        <tr><td id='element0'></td><td id='element1'></td><td id='element2'></td></tr></table>
        <table>
            <tr><td>X:</td><td><input type='text' id='setX'></td></tr>
            <tr><td>Y:</td><td><input type='text' id='setY'></td></tr>
            <tr><td>Z:</td><td><input type='text' id='setZ'></td></tr>
            <tr><td colspan='2'><input type='button' onclick='send()'></td></tr>
        </table>
        <div id="element"></div>
    </body>
</html>
